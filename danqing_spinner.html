<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Performance Rating Wheel of Fortune</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #ffe4ec 0%, #fff 100%);
      text-align: center;
    }
    h1 {
      margin-top: 40px;
      font-size: 2.2em;
      color: #222;
      font-weight: bold;
    }
    .subtitle {
      color: #888;
      font-size: 1.1em;
      margin-bottom: 20px;
    }
    #canvas {
      margin-top: 10px;
      background: transparent;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0,0,0,0.07);
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .cta {
      margin-top: 30px;
      color: #888;
      font-size: 1.15em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    #result {
      margin-top: 30px;
      font-size: 1.3em;
      font-weight: bold;
      color: #d7263d;
      min-height: 2em;
    }
  </style>
</head>
<body>
  <h1>Performance Rating Wheel of Fortune</h1>
  <div class="subtitle">Spin until morale improves.</div>
  <canvas id="canvas" width="400" height="400"></canvas>
  <div class="cta">
    <span>Click the wheel to discover your performance rating!</span>
    <span style="font-size:1.3em;">ðŸŽ¯</span>
  </div>
  <div id="result"></div>
  <script>
    // Spinner slice definitions (labels, percentages, colors)
    const slices = [
      { label: "RE", percent: 1, color: "#ffe066" },           // yellow
      { label: "GE", percent: 19, color: "#d7263d" },   // red
      { label: "EE", percent: 35, color: "#36cfc9" },           // teal
      { label: "CME", percent: 35, color: "#7bd389" },   // light green
      { label: "MM", percent: 8, color: "#ff6f91" },           // pink
      { label: "MS", percent: 1, color: "#a259c6" },            // purple
      { label: "DNM", percent: 1, color: "#f7cac9" }         // light pink
    ];

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const radius = canvas.width / 2;
    let rotation = 0;
    let spinning = false;

    // Draw the spinner wheel
    function drawWheel(rot = 0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let angle = rot;
      slices.forEach(slice => {
        const sliceAngle = (slice.percent / 100) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius - 10, angle, angle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = slice.color;
        ctx.fill();
        // Draw label
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(angle + sliceAngle / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#222";
        ctx.font = "bold 16px Arial";
        ctx.fillText(slice.label, radius - 40, 0);
        ctx.restore();
        angle += sliceAngle;
      });
      // Draw center circle (spin button)
      ctx.beginPath();
      ctx.arc(radius, radius, 60, 0, 2 * Math.PI);
      ctx.fillStyle = "#ffe066";
      ctx.fill();
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.fillStyle = "#222";
      ctx.font = "bold 28px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("SPIN!", radius, radius);

      // Draw pointer (needle) at top - now orange
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(radius, 18);
      ctx.lineTo(radius - 18, 45);
      ctx.lineTo(radius + 18, 45);
      ctx.closePath();
      ctx.fillStyle = "#ff9800"; // orange needle
      ctx.fill();
      ctx.restore();
    }

    drawWheel();

    // Helper: Get slice at needle position
    function getSliceAtNeedle(rot) {
      // Needle is at angle 0, so we want the slice that covers angle = (2PI - (rot % 2PI)) % 2PI
      let normalizedAngle = (2 * Math.PI - (rot % (2 * Math.PI))) % (2 * Math.PI);
      let angle = 0;
      for (let i = 0; i < slices.length; i++) {
        const sliceAngle = (slices[i].percent / 100) * 2 * Math.PI;
        // Use <= for start, < for end, and add a small epsilon to avoid floating point errors
        if (normalizedAngle >= angle - 1e-10 && normalizedAngle < angle + sliceAngle - 1e-10) {
          return slices[i].label;
        }
        angle += sliceAngle;
      }
      // If not found due to rounding, return last slice
      return slices[slices.length - 1].label;
    }

    // Spin logic
    function spinWheel() {
      if (spinning) return;
      spinning = true;
      let spinTime = 0;
      let spinDuration = 3000 + Math.random() * 1000;
      let lastTimestamp = null;
      let startRotation = rotation;
      let extraSpins = Math.floor(Math.random() * 3) + 3; // 3-5 full spins

      function animateSpin(timestamp) {
        if (!lastTimestamp) lastTimestamp = timestamp;
        let delta = timestamp - lastTimestamp;
        lastTimestamp = timestamp;
        spinTime += delta;
        // Ease out
        let progress = Math.min(spinTime / spinDuration, 1);
        let eased = 1 - Math.pow(1 - progress, 3);
        rotation = startRotation + eased * (2 * Math.PI * extraSpins + Math.random() * 2 * Math.PI);
        drawWheel(rotation);
        if (progress < 1) {
          requestAnimationFrame(animateSpin);
        } else {
          spinning = false;
          // Use robust slice calculation
          let resultLabel = getSliceAtNeedle(rotation);
        //  document.getElementById('result').textContent =
         //   `Your performance rating is: ${resultLabel}! ðŸŽ‰`;
        }
      }
      requestAnimationFrame(animateSpin);
    }

    // Click to spin (center circle or anywhere on wheel)
    canvas.addEventListener('click', spinWheel);
  </script>
</body>
</html>
